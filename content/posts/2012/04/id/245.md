---
Title: サーバ統合して省エネを目指すぜ! (VM編5)
Categories: ['computer', 'FreeBSD', 'VirtualBox', 'WHS', 'ZFS']
Date: 2012-04-01T20:47:20+09:00
---

FreeBSD 9.0R上のVirtualBoxで運用している WHS2011だが、どうもバックアップDBが壊れて各PCのバックアップが止まってることが多かった。

まあ、気付くたびにDB修復をしていたのだが、どうもそれも失敗しだしたのでちょっと調べてみた。DB修復中のメモリ使用量をタスクマネージャーで眺めていたら、修復プロセスのメモリ使用量が2GBちかくなっていたので、仮想マシンに渡すメモリを2GBから3GBに変更してみた。そしてたら、修復も成功するようになったし、その後DBの破損もない。WHS2011は仮想メモリONになってるのだが、仮想マシン上で動かす場合は、2GBだけではちょっとツラいのかもしれない(もしかしたらportsのVirtualBox 4.1.8の問題だったのかもしれないが)。

メモリ16GBのうち仮想マシンに3GBも持っていかれるとZFSのARCが小さくなるじゃないか、と思ってしまったので、8GBのDDR3 DIMMがもうちょっと安くなったらメモリ32GBにしようと強く思ったのだった。

ちなみに電気代そこそこ下がったので、WHSの仮想マシン化の意味はあったようだ。

(4/8追記)

今のところ3GBあげていれば安定しているように見える。まぁ、WHS2011は64bit専用だし、それくらいはあげるべきなんだろう、きっと。

&nbsp;
